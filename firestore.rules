rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    function signedIn() {
      return request.auth != null;
    }

    // Fitness Challenge Tracker data model
    // challenges/{challengeId}
    //   ownerId: string (uid)
    // progress/{progressId}
    //   challengeId: string
    //   userId: string (uid)
    //   day: number

    match /challenges/{challengeId} {
      allow read: if signedIn();
      allow create: if signedIn() && request.resource.data.ownerId == request.auth.uid;
      allow update, delete: if signedIn() && resource.data.ownerId == request.auth.uid;
    }

    match /progress/{progressId} {
      // Authenticated users can read progress for leaderboards
      allow read: if signedIn();
      // Users can only write their own progress entries
      allow create: if signedIn() && request.resource.data.userId == request.auth.uid;
      allow update, delete: if signedIn() && resource.data.userId == request.auth.uid;
    }
  }
}
